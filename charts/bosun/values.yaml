global:
  namespace: ""
  image:
    tag: ""
  imagePullSecrets: []
  labels: {}
  annotations: {}
  podAnnotations: {}
  nodeSelector: {}
  tolerations: []
  affinity: {}
  resources:
    requests: {}
    limits: {}

nameOverride: ""
fullnameOverride: ""

scm:
  mode: github
  github:
    secretName: github-secrets
  gitlab:
    patSecretName: gitlab-secrets
    patSecretKey: GITLAB_PAT
    apiEndpoint: https://gitlab.com/api/v4

internalApiToken:
  create: true
  secretName: fluyt-internal-api-secrets

bow:
  enabled: true
  replicas: 2
  image:
    repository: ghcr.io/bosun-ai/fluyt/bow
    tag: ""
    pullPolicy: IfNotPresent
  command: []
  args: []
  containerPort: 80
  terminationGracePeriodSeconds: 30
  env:
    BACKEND_URL: ""
    BUN_ENV: production
    NODE_ENV: production
  service:
    type: ClusterIP
    port: 80
  ingress:
    enabled: false
    className: ""
    annotations: {}
    hosts:
      - host: app.example.com
        paths:
          - path: /
            pathType: Prefix
    tls: []
  pdb:
    enabled: true
    minAvailable: 1
  probes:
    readiness:
      httpGet:
        path: /
        port: http
      initialDelaySeconds: 5
      periodSeconds: 10
      failureThreshold: 3
    liveness:
      httpGet:
        path: /
        port: http
      initialDelaySeconds: 30
      periodSeconds: 30
      failureThreshold: 4
  resources: {}
  nodeSelector: {}
  tolerations: []
  affinity: {}
  podAnnotations: {}

stern:
  enabled: true
  replicas: 2
  image:
    repository: ghcr.io/bosun-ai/fluyt/stern
    tag: ""
    pullPolicy: IfNotPresent
  command: []
  args: []
  containerPort: 3000
  terminationGracePeriodSeconds: 120
  env:
    RAILS_ENV: production
    REDIS_URL: ""
    QUAK_URL: ""
    ROOT_URL: ""
    BILLING_DISABLED: "true"
  secrets:
    existing:
      - stern-secrets
      - github-secrets
      - fluyt-envelope-encr-secrets
      - fluyt-internal-api-secrets
  database:
    url: ""
    existingSecret: ""
    existingSecretKey: uri
  service:
    type: ClusterIP
    port: 3000
  ingress:
    enabled: false
    className: ""
    annotations: {}
    hosts:
      - host: api.example.com
        paths:
          - path: /api
            pathType: Prefix
          - path: /up
            pathType: Prefix
          - path: /cable
            pathType: Prefix
          - path: /github/webhook
            pathType: Prefix
          - path: /stripe/webhook
            pathType: Prefix
      - host: app.example.com
        paths:
          - path: /api
            pathType: Prefix
    tls: []
  pdb:
    enabled: true
    minAvailable: 1
  probes:
    readiness:
      httpGet:
        path: /up
        port: http
      initialDelaySeconds: 10
      periodSeconds: 10
      failureThreshold: 3
    liveness:
      httpGet:
        path: /up
        port: http
      initialDelaySeconds: 60
      periodSeconds: 30
      failureThreshold: 4
    startup:
      httpGet:
        path: /up
        port: http
      failureThreshold: 18
      periodSeconds: 10
  migrations:
    enabled: true
    hook:
      enabled: true
      deletePolicy: before-hook-creation,hook-succeeded
    command:
      - /bin/sh
      - -c
      - |
        set -e
        bundle exec rails db:create
        bundle exec rails db:create:cache
        bundle exec rails db:create:queue
        bundle exec rails db:create:cable
        bundle exec rails db:migrate
        bundle exec rails db:migrate:cache
        bundle exec rails db:migrate:queue
        bundle exec rails db:migrate:cable
    backoffLimit: 3
    ttlSecondsAfterFinished: 3600
  billingWorker:
    enabled: true
    replicas: 1
    strategy:
      type: Recreate
    command:
      - bin/thrust
      - bin/jobs
    probes:
      readiness:
        exec:
          command:
            - /bin/sh
            - -c
            - pgrep -f "bin/thrust bin/jobs"
        initialDelaySeconds: 30
        periodSeconds: 30
        failureThreshold: 3
      liveness:
        exec:
          command:
            - /bin/sh
            - -c
            - pgrep -f "bin/thrust bin/jobs"
        initialDelaySeconds: 60
        periodSeconds: 30
        failureThreshold: 3
      startup:
        exec:
          command:
            - /bin/sh
            - -c
            - pgrep -f "bin/thrust bin/jobs"
        failureThreshold: 20
        periodSeconds: 6
    resources: {}
  resources: {}
  nodeSelector: {}
  tolerations: []
  affinity: {}
  podAnnotations: {}

quak:
  enabled: true
  replicas: 2
  serviceAccountName: ""
  image:
    repository: ghcr.io/bosun-ai/fluyt/quak
    tag: ""
    pullPolicy: IfNotPresent
  command: []
  args: []
  containerPort: 3001
  terminationGracePeriodSeconds: 1800
  env:
    QDRANT_URL: ""
    REDIS_URL: ""
    REDIS_INDEXING_URL: ""
    RUST_LOG: quak=debug,kwaak=debug,swiftide=debug,warn
    OTEL_ENABLED: "false"
    KUBERNETES_ENABLED: "true"
    EXECUTOR_TAG: latest
  secrets:
    existing:
      - quak-secrets
      - github-secrets
      - fluyt-envelope-encr-secrets
      - fluyt-internal-api-secrets
  service:
    type: ClusterIP
    port: 3001
    sessionAffinity: ClientIP
    sessionAffinityTimeoutSeconds: 14400
  rbac:
    enabled: true
  executorNamespace:
    name: ""
    create: false
  executor:
    persistence:
      enabled: true
      storageClass: bosun-executor-encrypted
      size: 40Gi
    resources:
      requests:
        cpu: "2000m"
        memory: "4096Mi"
      limits:
        cpu: "2000m"
        memory: "4096Mi"
  pdb:
    enabled: true
    minAvailable: 1
  probes:
    readiness:
      httpGet:
        path: /health
        port: http
      initialDelaySeconds: 10
      periodSeconds: 10
      failureThreshold: 3
    liveness:
      httpGet:
        path: /health
        port: http
      initialDelaySeconds: 60
      periodSeconds: 30
      failureThreshold: 4
    startup:
      httpGet:
        path: /health
        port: http
      failureThreshold: 30
      periodSeconds: 10
  resources: {}
  nodeSelector: {}
  tolerations: []
  affinity: {}
  podAnnotations: {}

prepull:
  enabled: false
  image:
    repository: bosunai/swiftide-docker-universal
    tag: latest
    pullPolicy: Always
  hook:
    enabled: false
    deletePolicy: before-hook-creation,hook-succeeded
  tolerations:
    - key: tasks-only
      operator: Equal
      value: "true"
      effect: NoSchedule

overprovisioner:
  enabled: false
  replicas: 1
  priorityClass:
    create: true
    name: overprovisioning-low
    value: -10
    globalDefault: false
    description: Preemptable padding pods that reserve capacity for task executors.
  nodeSelector:
    tasks-only: "true"
  tolerations:
    - key: tasks-only
      operator: Equal
      value: "true"
      effect: NoSchedule
  resources:
    requests:
      cpu: "2000m"
      memory: "4096Mi"
    limits:
      cpu: "2000m"
      memory: "4096Mi"

storageClass:
  enabled: false
  name: bosun-executor-encrypted
  annotations:
    bosun.ai/intent: Encrypt executor PVCs for customer repositories
  provisioner: csi.hetzner.cloud
  reclaimPolicy: Delete
  volumeBindingMode: WaitForFirstConsumer
  allowVolumeExpansion: true
  parameters:
    csi.storage.k8s.io/node-publish-secret-name: executor-volume-encryption
    csi.storage.k8s.io/node-publish-secret-namespace: kube-system

envelopeEncryption:
  create: true
  secretName: fluyt-envelope-encr-secrets
  job:
    opensslImage:
      repository: alpine/openssl
      tag: "latest"
      pullPolicy: IfNotPresent
    kubectlImage:
      repository: bitnami/kubectl
      tag: "latest"
      pullPolicy: IfNotPresent
    backoffLimit: 1

postgres:
  enabled: true
  replicas: 1
  image:
    repository: postgres
    tag: 15-alpine
    pullPolicy: IfNotPresent
  auth:
    username: bosun
    password: bosun
    database: bosun
    existingSecret: ""
    usernameKey: username
    passwordKey: password
    databaseKey: database
    baseUrlKey: baseUrl
  service:
    port: 5432
  persistence:
    enabled: false
    size: 10Gi
    accessModes:
      - ReadWriteOnce
    storageClass: ""
  resources: {}
  nodeSelector: {}
  tolerations: []
  affinity: {}
  podAnnotations: {}

redis:
  enabled: true
  shared:
    enabled: true
    replicas: 1
    image:
      repository: redis
      tag: 7-alpine
      pullPolicy: IfNotPresent
    service:
      port: 6379
    persistence:
      enabled: false
      size: 1Gi
      accessModes:
        - ReadWriteOnce
      storageClass: ""
    resources: {}
  indexing:
    enabled: true
    replicas: 1
    image:
      repository: redis
      tag: 7-alpine
      pullPolicy: IfNotPresent
    service:
      port: 6379
    persistence:
      enabled: false
      size: 1Gi
      accessModes:
        - ReadWriteOnce
      storageClass: ""
    resources: {}

qdrant:
  enabled: true
  replicas: 1
  image:
    repository: qdrant/qdrant
    tag: v1.8.4
    pullPolicy: IfNotPresent
  service:
    httpPort: 6333
    grpcPort: 6334
  persistence:
    enabled: false
    size: 10Gi
    accessModes:
      - ReadWriteOnce
    storageClass: ""
  resources: {}
  nodeSelector: {}
  tolerations: []
  affinity: {}
  podAnnotations: {}
